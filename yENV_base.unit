#!/usr/local/bin/koios
#   koios-polos (axis of heaven) unit testing meta-language



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  ========(var)======= 
SCRP    [0c]  (BASE) verify version string                                       0s   version         yENV_version                                                                 ((01.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       prepare for run                                                    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     prepare for testing                  yENV__unit_quiet                                                                                                                  i_equal     0                                                                                                    

   COND       verify version string                                              - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call version                         yENV_version                                                                                                                      s_equal     [gnu gcc    ]   ¬.¬¬ : ¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬  

   COND       end the test                                                       - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((03.010))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     wrap up testing                      yENV__unit_end                                                                                                                    i_equal     0                                                                                                    



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  ========(var)======= 
SCRP  [··/·]  (BASE) verify who am i                                              0s  whoami          yENV_whoami                                                                  ((03.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       prepare for run                                                    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((03.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     prepare for testing                  yENV__unit_quiet                                                                                                                  i_equal     0                                                                                                    
     local    create a saved pid                   - - - - - - - - - - - - -   int   x_spid  = getpid ();                                                                                                                                                                                                 
     local    create a saved ppid                  - - - - - - - - - - - - -   int   x_sppid = getppid ();                                                                                                                                                                                                
     local    create a pid variable                - - - - - - - - - - - - -   int   x_pid  , x_ppid;                                                                                                                                                                                                     
     local    create a uid variable                - - - - - - - - - - - - -   int   x_uid  , x_euid;                                                                                                                                                                                                     
     local    create a uid variable                - - - - - - - - - - - - -   int   x_gid  , x_egid;                                                                                                                                                                                                     
     local    create a root variable               - - - - - - - - - - - - -   char  x_root  = '-';                                                                                                                                                                                                       
     local    create a user variable               - - - - - - - - - - - - -   char  x_user  [LEN_USER];                                                                                                                                                                                                  
     local    create a user variable               - - - - - - - - - - - - -   char  x_group [LEN_USER];                                                                                                                                                                                                  

   COND       verify as root                                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((03.002))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call user validation                 yENV_whoami                 &x_pid  , &x_ppid  , &x_uid  , &x_euid , &x_root  , x_user  , 'n'     , &x_gid  , &x_egid , x_group   i_equal     0                                                                                                    
     echo     ...check returned pid                - - - - - - - - - - - - -   x_pid                                                                                                 i_equal     [[ x_spid ]]                                                                                         
     echo     ...check returned ppid               - - - - - - - - - - - - -   x_ppid                                                                                                i_equal     [[ x_sppid ]]                                                                                        
     echo     ...check returned uid                - - - - - - - - - - - - -   x_uid                                                                                                 i_equal     0                                                                                                    
     echo     ...check returned euid               - - - - - - - - - - - - -   x_euid                                                                                                i_equal     0                                                                                                    
     echo     ...check returned user               - - - - - - - - - - - - -   x_user                                                                                                w_equal     årootæ                                                                                               
     echo     ...check returned root flag          - - - - - - - - - - - - -   x_root                                                                                                c_equal     'y'                                                                                                  
     echo     ...check returned gid                - - - - - - - - - - - - -   x_gid                                                                                                 i_equal     0                                                                                                    
     echo     ...check returned egid               - - - - - - - - - - - - -   x_egid                                                                                                i_equal     0                                                                                                    
     echo     ...check returned group              - - - - - - - - - - - - -   x_group                                                                                               w_equal     årootæ                                                                                               

   COND       verify moving to normal user (effective)                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((03.003))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     change to member                     - - - - - - - - - - - - -   seteuid (1000);                                                                                                                                                                                                            
     exec     call user validation                 yENV_whoami                 &x_pid  , &x_ppid  , &x_uid  , &x_euid , &x_root  , x_user  , 'n'     , &x_gid  , &x_egid , x_group   i_equal     0                                                                                                    
     echo     ...check returned pid                - - - - - - - - - - - - -   x_pid                                                                                                 i_equal     [[ x_spid ]]                                                                                         
     echo     ...check returned ppid               - - - - - - - - - - - - -   x_ppid                                                                                                i_equal     [[ x_sppid ]]                                                                                        
     echo     ...check returned uid                - - - - - - - - - - - - -   x_uid                                                                                                 i_equal     0                                                                                                    
     echo     ...check returned euid               - - - - - - - - - - - - -   x_euid                                                                                                i_equal     1000                                                                                                 
     echo     ...check returned user               - - - - - - - - - - - - -   x_user                                                                                                w_equal     åmemberæ                                                                                             
     echo     ...check returned root flag          - - - - - - - - - - - - -   x_root                                                                                                i_equal     '-'                                                                                                  
     echo     ...check returned gid                - - - - - - - - - - - - -   x_gid                                                                                                 i_equal     0                                                                                                    
     echo     ...check returned egid               - - - - - - - - - - - - -   x_egid                                                                                                i_equal     0                                                                                                    
     echo     ...check returned group              - - - - - - - - - - - - -   x_group                                                                                               w_equal     årootæ                                                                                               
     code     change back to root                  - - - - - - - - - - - - -   seteuid (   0);                                                                                                                                                                                                            

   COND       verify moving to another group (effective)                         - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((03.003))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     change to users                      - - - - - - - - - - - - -   setegid ( 100);                                                                                                                                                                                                            
     exec     call user validation                 yENV_whoami                 &x_pid  , &x_ppid  , &x_uid  , &x_euid , &x_root  , x_user  , 'n'     , &x_gid  , &x_egid , x_group   i_equal     0                                                                                                    
     echo     ...check returned pid                - - - - - - - - - - - - -   x_pid                                                                                                 i_equal     [[ x_spid ]]                                                                                         
     echo     ...check returned ppid               - - - - - - - - - - - - -   x_ppid                                                                                                i_equal     [[ x_sppid ]]                                                                                        
     echo     ...check returned uid                - - - - - - - - - - - - -   x_uid                                                                                                 i_equal     0                                                                                                    
     echo     ...check returned euid               - - - - - - - - - - - - -   x_euid                                                                                                i_equal     0                                                                                                    
     echo     ...check returned user               - - - - - - - - - - - - -   x_user                                                                                                w_equal     årootæ                                                                                               
     echo     ...check returned root flag          - - - - - - - - - - - - -   x_root                                                                                                i_equal     'y'                                                                                                  
     echo     ...check returned gid                - - - - - - - - - - - - -   x_gid                                                                                                 i_equal     0                                                                                                    
     echo     ...check returned egid               - - - - - - - - - - - - -   x_egid                                                                                                i_equal     100                                                                                                  
     echo     ...check returned group              - - - - - - - - - - - - -   x_group                                                                                               w_equal     åusersæ                                                                                              
     code     change back to root                  - - - - - - - - - - - - -   setegid (   0);                                                                                                                                                                                                            

   COND       wrap up testing                                                    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((03.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     wrap up testing                      yENV__unit_end                                                                                                                    i_equal     0                                                                                                    

